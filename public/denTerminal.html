<!DOCTYPE html>
<html>
<head>
  <title>SQL Console</title>
  <style>
    body { font-family: Arial; margin: 20px; }
    textarea { width: 100%; height: 100px; }
    pre { background: #eee; padding: 10px; border-radius: 4px; }
  </style>
</head>
<body>
  <h2>MySQL Web Console</h2>
  <textarea id="query" placeholder="Enter SQL command..."></textarea><br>
  <button onclick="runSQL()">Run SQL</button>
  <h3>Result:</h3>
  <pre id="output"></pre>

  <script>
    async function runSQL() {
    const sql = document.getElementById('query').value;
    const outputElement = document.getElementById('output');
    outputElement.textContent = "Running query..."; // Clear and set status

    try {
        const res = await fetch('/api/user/query', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ sql })
        });

        // --- FIX 1: Check if the response was successful (status 200-299) ---
        if (!res.ok) {
            // If the server returns a bad status (e.g., 400 or 500)
            // Check if the server sent back JSON with an error message
            try {
                const errorData = await res.json();
                outputElement.textContent = `Server Error (${res.status}):\n${JSON.stringify(errorData, null, 2)}`;
            } catch (e) {
                // FIX 2: If the server sent back plain text/HTML error page (Scenario 1)
                const text = await res.text();
                outputElement.textContent = `HTTP Error (${res.status}): Cannot parse response. Server sent back:\n${text.substring(0, 300)}...`;
            }
            return; // Stop execution
        }

        // --- Execution continues here only if res.ok is true (status 200) ---
        const data = await res.json();
        outputElement.textContent = JSON.stringify(data, null, 2);

    } catch (error) {
        // This catches network errors or other unexpected issues
        outputElement.textContent = `Network or Parsing Failure: ${error.message}`;
        console.error(error);
    }
    }
  </script>
</body>
</html>